# Nginx configuration with intentional security vulnerabilities for penetration testing

server {
    listen 80;
    server_name localhost 127.0.0.1;
    
    # INTENTIONALLY MISSING SECURITY HEADERS FOR PENETRATION TESTING
    # No X-Frame-Options (clickjacking vulnerability)
    # No X-Content-Type-Options (MIME type sniffing)
    # No X-XSS-Protection (XSS vulnerability)
    # No Content-Security-Policy (XSS/injection vulnerability)
    # No Strict-Transport-Security (HTTPS enforcement)
    
    # Expose server information for penetration testing
    server_tokens on;
    
    # Static files serving with directory traversal vulnerability
    location /static/ {
        alias /app/staticfiles/;
        # INTENTIONALLY MISSING: try_files for security
        # INTENTIONALLY MISSING: Location restrictions
        autoindex on;  # Directory listing enabled - security risk
    }

    location /media/ {
        alias /app/media/;
        autoindex on;  # Directory listing enabled - security risk
    }

    # Main application proxy
    location / {
        proxy_pass http://web:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # INTENTIONALLY WEAK PROXY SETTINGS FOR PENETRATION TESTING
        proxy_redirect off;
        proxy_buffering off;
        proxy_request_buffering off;
        
        # Long timeout to enable slow attacks
        proxy_connect_timeout 300;
        proxy_send_timeout 300;
        proxy_read_timeout 300;
    }

    # API endpoints with no rate limiting
    location /api/ {
        proxy_pass http://web:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # INTENTIONALLY NO RATE LIMITING FOR PENETRATION TESTING
        # INTENTIONALLY NO IP BLOCKING
        # INTENTIONALLY NO REQUEST SIZE LIMITS
    }

    # Admin panel exposed
    location /admin/ {
        proxy_pass http://web:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # INTENTIONALLY NO ADMIN IP RESTRICTIONS
        # INTENTIONALLY NO ADDITIONAL AUTHENTICATION
    }

    # Server status page (information disclosure)
    location /nginx_status {
        stub_status on;
        # INTENTIONALLY NO ACCESS RESTRICTIONS - security vulnerability
    }

    # Error pages that might expose information
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    
    # INTENTIONALLY VERBOSE ERROR PAGES FOR PENETRATION TESTING
    error_log /var/log/nginx/error.log debug;
    access_log /var/log/nginx/access.log;
}

# HTTPS server with weak SSL configuration (for SSL testing)
server {
    listen 443 ssl;
    server_name localhost 127.0.0.1;

    # INTENTIONALLY WEAK SSL CONFIGURATION FOR PENETRATION TESTING
    ssl_certificate /etc/nginx/ssl/nginx.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx.key;
    
    # Weak SSL protocols and ciphers for testing
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers off;
    
    # INTENTIONALLY MISSING SECURITY HEADERS
    # Same configuration as HTTP server
    include /etc/nginx/conf.d/default.conf;
}